@app.route('/detections')
def detections():
    ret, frame = cap.read()
    if not ret:
        return jsonify([])

    input_tensor = tf.convert_to_tensor(frame)
    input_tensor = input_tensor[tf.newaxis, ...]
    detections = detect_fn(input_tensor)

    boxes = detections['detection_boxes'].numpy()
    class_ids = detections['detection_classes'].numpy().astype(np.int32)
    scores = detections['detection_scores'].numpy()

    objects_detected = []

    num_boxes = boxes.shape[1]
    for i in range(num_boxes):
        if scores[0][i] > 0.5:
            label = COCO_LABELS[class_ids[0][i]] if 0 < class_ids[0][i] < len(COCO_LABELS) else 'Unknown'
            objects_detected.append(label)

    face_locations = face_recognition.face_locations(frame)
    face_encodings = face_recognition.face_encodings(frame, face_locations)

    for _, face_encoding in zip(face_locations, face_encodings):
        matches = face_recognition.compare_faces(known_face_encodings, face_encoding)
        name = "Unknown"
        if True in matches:
            first_match_index = matches.index(True)
            name = known_face_names[first_match_index]
        else:
            # Trigger the buzzer for unknown faces
            GPIO.output(BUZZER_PIN, GPIO.HIGH)
            time.sleep(0.5)  # Buzzer ON duration
            GPIO.output(BUZZER_PIN, GPIO.LOW)

        objects_detected.append(f"Face: {name}")

    return jsonify(objects_detected)
