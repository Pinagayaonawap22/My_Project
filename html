import RPi.GPIO as GPIO
import time
from flask import Flask, render_template, jsonify

app = Flask(__name__)
# Pin setup
pir_sensor_pin = 26  
buzzer_pin = 20    

# Setup GPIO mode
GPIO.setmode(GPIO.BCM)
GPIO.setwarnings(False)  
GPIO.setup(pir_sensor_pin, GPIO.IN)  
GPIO.setup(buzzer_pin, GPIO.OUT)   

@app.route('/')
def index():
    return render_template('index1.html')

with open('file_motion.txt', 'a') as file:
    count = 0
    try:
        while True:
            if GPIO.input(pir_sensor_pin): 
                print("Motion Detected") 
                file.write('1\n')  # Write 1 to file
                count += 1
            else:
                print("No Motion") 
                file.write('0\n')  # Write 0 to file
                count += 1

            if count >= 100:  # Adjust the count as needed
                file.flush()  # Ensure data is written immediately
                count = 0  # Reset count

            GPIO.output(buzzer_pin, GPIO.HIGH if GPIO.input(pir_sensor_pin) else GPIO.LOW)
            time.sleep(1)

    except KeyboardInterrupt:
        print("Program stopped")

    finally:
        GPIO.cleanup()
        
    if __name__ == '__main__':

    app.run(host='0.0.0.0', port=5028, debug=True)

