import time
import RPi.GPIO as GPIO
from flask import Flask, render_template, jsonify

app = Flask(__name__)

# GPIO setup
GPIO.setmode(GPIO.BCM)
GPIO.setwarnings(False)

# Define GPIO pins
buzzer_pin = 20
pir_pin = 26

# Set up GPIO pins
GPIO.setup(buzzer_pin, GPIO.OUT)
GPIO.setup(pir_pin, GPIO.IN)

def buzzer_on():
    GPIO.output(buzzer_pin, GPIO.HIGH)

def buzzer_off():
    GPIO.output(buzzer_pin, GPIO.LOW)

def buzzer_sensor(duration):
    GPIO.output(buzzer_pin, GPIO.HIGH)
    time.sleep(duration)
    GPIO.output(buzzer_pin, GPIO.LOW)

def Motion_detection_Web():
    while True:
        if GPIO.input(pir_pin):
            buzzer_sensor(1)
            pirValue = True
        else:
            buzzer_off()
            pirValue = False
        time.sleep(0.1)  # Short delay to avoid rapid polling
        return pirValue

@app.route('/')
def index():
    return render_template('index1.html')

@app.route('/Raspi_data')
def Raspi_data():
    MotionData = Motion_detection_Web()
    if GPIO.input(pir_pin):
        print("Motion detected!")
    else:
        print("No motion")
    
    return jsonify(Motion=MotionData)

if __name__ == '__main__':
    app.run(host='0.0.0.0', port=5012, debug=True)

